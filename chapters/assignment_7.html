<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8. Week Report 7 &mdash; Tsunami Lab  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. Weekly Report 8" href="assignment_8.html" />
    <link rel="prev" title="7. Week Report 6" href="assignment_6.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Tsunami Lab
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="user_documentation.html">1. User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment_1.html">2. Report Week 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment_2.html">3. Report Week 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment_3.html">4. Week Report 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment_4.html">5. Week Report 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment_5.html">6. Week Report 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment_6.html">7. Week Report 6</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8. Week Report 7</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#checkpoints">8.1. Checkpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="#coarse-output">8.2. Coarse Output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulation-of-2011-tohoku-with-coarse-output">8.2.1. Simulation of 2011 Tohoku with coarse Output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="assignment_8.html">9. Weekly Report 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment_9.html">10. Weekly Report 9</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment_10.html">11. individual Phase - Intermediate Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="assignment_11.html">12. Individual Phase - Final Report</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Tsunami Lab</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">8. </span>Week Report 7</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/chapters/assignment_7.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="week-report-7">
<span id="ch-task-7"></span><h1><span class="section-number">8. </span>Week Report 7<a class="headerlink" href="#week-report-7" title="Link to this heading"></a></h1>
<section id="checkpoints">
<h2><span class="section-number">8.1. </span>Checkpoints<a class="headerlink" href="#checkpoints" title="Link to this heading"></a></h2>
<p>The <code class="code docutils literal notranslate"><span class="pre">NetCDF.cpp</span></code> file was revised as part of the checkpointing process. Instead of writing the individual frames directly to the output file each time,
the class structure is now used to store the data in this file (until there is a write request, e.g. checkpoint).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">tsunami_lab::io::NetCDF::store</span><span class="p">(</span><span class="n">t_real</span><span class="w"> </span><span class="n">i_simTime</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">t_idx</span><span class="w"> </span><span class="n">i_frame</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">t_real</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">i_h</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">t_real</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">i_hu</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">t_real</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="n">i_hv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_time</span><span class="p">[</span><span class="n">i_frame</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_simTime</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">t_idx</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_ny</span><span class="p">;</span><span class="w"> </span><span class="n">l_iy</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">t_idx</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_nx</span><span class="p">;</span><span class="w"> </span><span class="n">l_ix</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">t_real</span><span class="w"> </span><span class="n">l_h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_h</span><span class="p">[(</span><span class="n">l_iy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_stride</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">l_ix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span>
<span class="w">            </span><span class="n">t_real</span><span class="w"> </span><span class="n">l_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_dataB</span><span class="p">[</span><span class="n">l_iy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_ix</span><span class="p">];</span>
<span class="w">            </span><span class="n">m_height</span><span class="p">[</span><span class="n">l_ix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m_nxy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i_frame</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l_h</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_b</span><span class="p">;</span>
<span class="w">            </span><span class="n">m_momentumX</span><span class="p">[</span><span class="n">l_ix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m_nxy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i_frame</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_hu</span><span class="p">[(</span><span class="n">l_iy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_stride</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">l_ix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span>
<span class="w">            </span><span class="n">m_momentumY</span><span class="p">[</span><span class="n">l_ix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m_nxy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i_frame</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_hv</span><span class="p">[(</span><span class="n">l_iy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_stride</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">l_ix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In order for the checkpoints to fulfill their purpose, they must contain all the information that is normally contained in the output file (h, hv, hu, bathymetry, …).
This also ensures that the checkpoint files can be displayed in Paraview in the same way as the output files.</p>
<p>Furthermore the Simulation time <code class="code docutils literal notranslate"><span class="pre">SimTime</span></code> and End time <code class="code docutils literal notranslate"><span class="pre">EndTime</span></code> are also saved so that we can keep track of how far we have simulated and when we need to set the next checkpoint.</p>
<p>The question of the time intervals between checkpoints is clarified in the <code class="code docutils literal notranslate"><span class="pre">Simulation.cpp</span></code> file.
We have opted for a variable amount of Checkpoints, which can be changed in the corresponding configuration file (per default … Checkpoints per Simulation).</p>
<p>The time interval between checkpoints is calculated by: <span class="math notranslate nohighlight">\(\text{simTime}\)</span> % <span class="math notranslate nohighlight">\(\frac{\text{endTime}}{n_\text{Checkpoints}}\)</span></p>
<p>There is no writeCheckpoint function or whatsoever. The <code class="code docutils literal notranslate"><span class="pre">write</span></code> function can be called with or without parameters, which determines how it is used.</p>
<p>Each time a checkpoint is set, the function is called with parameters and in the end, when the solution file is to be written, no parameters are used.</p>
<p><code class="code docutils literal notranslate"><span class="pre">write</span></code> calls in Simulator.cpp:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// iterate over time</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">l_simTime</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">l_endTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l_timeStep</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;  simulation time / #time steps / #step: &quot;</span>
<span class="w">                  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">l_simTime</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; / &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">l_timeStep</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; / &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">l_frame</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">        </span><span class="n">l_writer</span><span class="o">-&gt;</span><span class="n">store</span><span class="p">(</span><span class="n">l_simTime</span><span class="p">,</span>
<span class="w">                        </span><span class="n">l_frame</span><span class="p">,</span>
<span class="w">                        </span><span class="n">l_waveProp</span><span class="o">-&gt;</span><span class="n">getHeight</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">l_waveProp</span><span class="o">-&gt;</span><span class="n">getMomentumX</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">l_waveProp</span><span class="o">-&gt;</span><span class="n">getMomentumY</span><span class="p">());</span>

<span class="w">                                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l_frame</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                        </span><span class="n">l_writer</span><span class="o">-&gt;</span><span class="n">write</span><span class="p">(</span><span class="n">l_frame</span><span class="p">,</span><span class="w"> </span><span class="n">l_checkpoint</span><span class="p">,</span><span class="w"> </span><span class="n">l_simTime</span><span class="p">,</span><span class="w"> </span><span class="n">l_endTime</span><span class="p">);</span>
<span class="w">                                        </span><span class="n">l_checkpoint</span><span class="o">++</span><span class="p">;</span>
<span class="w">                                 </span><span class="p">}</span>
<span class="w">        </span><span class="n">l_frame</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">l_waveProp</span><span class="o">-&gt;</span><span class="n">setGhostCells</span><span class="p">(</span><span class="n">i_simConfig</span><span class="p">.</span><span class="n">getBoundaryCondition</span><span class="p">());</span>
<span class="w">    </span><span class="n">l_waveProp</span><span class="o">-&gt;</span><span class="n">timeStep</span><span class="p">(</span><span class="n">l_scalingX</span><span class="p">,</span><span class="w"> </span><span class="n">l_scalingY</span><span class="p">);</span>

<span class="w">    </span><span class="n">l_timeStep</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="n">l_simTime</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">l_dt</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">l_writer</span><span class="o">-&gt;</span><span class="n">write</span><span class="p">();</span>

<span class="c1">// free memory</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;finished time loop&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;freeing memory&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="k">delete</span><span class="w"> </span><span class="n">l_writer</span><span class="p">;</span>
</pre></div>
</div>
<p>NetCDF <code class="code docutils literal notranslate"><span class="pre">write</span></code> function:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">tsunami_lab</span><span class="o">::</span><span class="n">io</span><span class="o">::</span><span class="n">NetCDF</span><span class="o">::</span><span class="n">write</span><span class="p">(</span><span class="n">t_idx</span><span class="w"> </span><span class="n">i_currentFrame</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">i_checkPointPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">t_real</span><span class="w"> </span><span class="n">i_simTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">                                   </span><span class="n">t_real</span><span class="w"> </span><span class="n">i_endTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// create netCDF file</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">l_outFileName</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_checkPointPath</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">l_outFileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_checkPointPath</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">l_outFileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_outFileName</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">l_outFileName</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_create</span><span class="p">((</span><span class="n">l_outFileName</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">NC_CLOBBER</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_ncId</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NC_NOERR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;NCError: Create file.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// define dims and vars</span>
<span class="w">    </span><span class="n">init</span><span class="p">(</span><span class="n">i_currentFrame</span><span class="p">,</span><span class="w"> </span><span class="n">i_checkPointPath</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// write data</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_checkPointPath</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varXId</span><span class="p">,</span><span class="w"> </span><span class="n">m_dataX</span><span class="p">);</span>
<span class="w">        </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varYId</span><span class="p">,</span><span class="w"> </span><span class="n">m_dataY</span><span class="p">);</span>
<span class="w">        </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varBathymetryId</span><span class="p">,</span><span class="w"> </span><span class="n">m_dataB</span><span class="p">);</span>
<span class="w">        </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varHeightId</span><span class="p">,</span><span class="w"> </span><span class="n">m_height</span><span class="p">);</span>
<span class="w">        </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varMomentumXId</span><span class="p">,</span><span class="w"> </span><span class="n">m_momentumX</span><span class="p">);</span>
<span class="w">        </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varMomentumYId</span><span class="p">,</span><span class="w"> </span><span class="n">m_momentumY</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varTimeId</span><span class="p">,</span><span class="w"> </span><span class="n">m_time</span><span class="p">);</span>

<span class="w">    </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varSimTimeId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i_simTime</span><span class="p">);</span>
<span class="w">    </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varEndTimeId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i_endTime</span><span class="p">);</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">l_currentFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_currentFrame</span><span class="p">;</span>
<span class="w">    </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_put_var_ulonglong</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varFrameId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">l_currentFrame</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NC_NOERR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;NCError: Put variables.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nc_close</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l_nc_err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NC_NOERR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;NCError: Close file.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">NC_NOERR</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">tsunami_lab</span><span class="o">::</span><span class="n">io</span><span class="o">::</span><span class="n">NetCDF</span><span class="o">::</span><span class="n">write</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="n">m_frameCount</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If there are older checkpoints, but you want to recalculate everything, there is a command line flag <code class="code docutils literal notranslate"><span class="pre">C</span></code> which can be used to ignore the existing checkpoints.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">tsunami_lab</span><span class="o">/</span><span class="w"> </span><span class="n">chile_250m</span><span class="p">.</span><span class="n">json</span><span class="w"> </span><span class="o">-</span><span class="n">C</span>
</pre></div>
</div>
<p>We do not delete old checkpoint files using the code, as this is eventually done by hand.</p>
<p>picture of Checkpoint files:</p>
<a class="reference internal image-reference" href="../_images/checkpoints.png"><img alt="../_images/checkpoints.png" src="../_images/checkpoints.png" style="width: 400px;" /></a>
</section>
<section id="coarse-output">
<h2><span class="section-number">8.2. </span>Coarse Output<a class="headerlink" href="#coarse-output" title="Link to this heading"></a></h2>
<p>To obtain a coarse output, several cells in a square must be combined into one cell. This works by iterating over the grid and taking every <span class="math notranslate nohighlight">\(k \text{'th}\)</span> cell and using a <span class="math notranslate nohighlight">\(2k-1 \times 2k-1\)</span> filter (similar to a blur filter in image processing).
The value of the cells is being divided by the number of cells in the square, typically <span class="math notranslate nohighlight">\((2k-1)^2\)</span> , and added together.
But it raises the question of what happens to cells that do not exist because they are outside the domain. If <span class="math notranslate nohighlight">\(k = 5\)</span> then there are not enough ghost cells at the edge to combine the cells.
In this case cells outside of the domain are ignored and the value of each cells is divided by <span class="math notranslate nohighlight">\((2k-1)^2 - n_\text{ignored cells}\)</span></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// coarse output</span>
<span class="n">t_idx</span><span class="w"> </span><span class="n">l_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">t_real</span><span class="w"> </span><span class="o">*</span><span class="n">l_dataX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">tsunami_lab</span><span class="o">::</span><span class="n">t_real</span><span class="p">[</span><span class="n">m_nxCoarse</span><span class="p">];</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">t_idx</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_nx</span><span class="p">;</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">l_dataX</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_dataX</span><span class="p">[</span><span class="n">l_ix</span><span class="p">];</span>
<span class="w">    </span><span class="n">l_idx</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">l_nc_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varXId</span><span class="p">,</span><span class="w"> </span><span class="n">l_dataX</span><span class="p">);</span>
<span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">l_dataX</span><span class="p">;</span>

<span class="n">l_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">t_real</span><span class="w"> </span><span class="o">*</span><span class="n">l_dataY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">tsunami_lab</span><span class="o">::</span><span class="n">t_real</span><span class="p">[</span><span class="n">m_nyCoarse</span><span class="p">];</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">t_idx</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_ny</span><span class="p">;</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">l_dataY</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_dataY</span><span class="p">[</span><span class="n">l_iy</span><span class="p">];</span>
<span class="w">    </span><span class="n">l_idx</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varYId</span><span class="p">,</span><span class="w"> </span><span class="n">l_dataY</span><span class="p">);</span>
<span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">l_dataY</span><span class="p">;</span>

<span class="n">l_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">t_real</span><span class="w"> </span><span class="o">*</span><span class="n">l_dataB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">tsunami_lab</span><span class="o">::</span><span class="n">t_real</span><span class="p">[</span><span class="n">m_nxyCoarse</span><span class="p">];</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">t_idx</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_ny</span><span class="p">;</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">t_idx</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_nx</span><span class="p">;</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// average over neighbors</span>
<span class="w">        </span><span class="n">l_dataB</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_dataB</span><span class="p">[</span><span class="n">l_iy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_ix</span><span class="p">];</span>
<span class="w">        </span><span class="n">t_idx</span><span class="w"> </span><span class="n">l_neighborCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l_offsetY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">m_coarseFactor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">l_offsetY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">m_coarseFactor</span><span class="p">;</span><span class="w"> </span><span class="n">l_offsetY</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l_offsetX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">m_coarseFactor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">l_offsetX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">m_coarseFactor</span><span class="p">;</span><span class="w"> </span><span class="n">l_offsetX</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">l_idxX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_offsetX</span><span class="p">;</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">l_idxY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_offsetY</span><span class="p">;</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tsunami_lab</span><span class="o">::</span><span class="n">io</span><span class="o">::</span><span class="n">NetCDF</span><span class="o">::</span><span class="n">isInBounds</span><span class="p">(</span><span class="n">l_idxX</span><span class="p">,</span><span class="w"> </span><span class="n">l_idxY</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">l_dataB</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_dataB</span><span class="p">[</span><span class="n">l_idxY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_idxX</span><span class="p">];</span>
<span class="w">                    </span><span class="n">l_neighborCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">l_dataB</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">l_neighborCount</span><span class="p">;</span>
<span class="w">        </span><span class="n">l_idx</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">l_nc_err</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">nc_put_var_float</span><span class="p">(</span><span class="n">m_ncId</span><span class="p">,</span><span class="w"> </span><span class="n">m_varBathymetryId</span><span class="p">,</span><span class="w"> </span><span class="n">l_dataB</span><span class="p">);</span>
<span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">l_dataB</span><span class="p">;</span>

<span class="n">l_idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">t_real</span><span class="w"> </span><span class="o">*</span><span class="n">l_height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">tsunami_lab</span><span class="o">::</span><span class="n">t_real</span><span class="p">[</span><span class="n">m_nxyCoarse</span><span class="p">];</span>
<span class="n">t_real</span><span class="w"> </span><span class="o">*</span><span class="n">l_momentumX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">tsunami_lab</span><span class="o">::</span><span class="n">t_real</span><span class="p">[</span><span class="n">m_nxyCoarse</span><span class="p">];</span>
<span class="n">t_real</span><span class="w"> </span><span class="o">*</span><span class="n">l_momentumY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">tsunami_lab</span><span class="o">::</span><span class="n">t_real</span><span class="p">[</span><span class="n">m_nxyCoarse</span><span class="p">];</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">t_idx</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_ny</span><span class="p">;</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">t_idx</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_nx</span><span class="p">;</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_coarseFactor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// average over neighbors</span>
<span class="w">        </span><span class="n">l_height</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_height</span><span class="p">[</span><span class="n">l_iy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_ix</span><span class="p">];</span>
<span class="w">        </span><span class="n">l_momentumY</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_momentumY</span><span class="p">[</span><span class="n">l_iy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_ix</span><span class="p">];</span>
<span class="w">        </span><span class="n">l_momentumY</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_momentumY</span><span class="p">[</span><span class="n">l_iy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_ix</span><span class="p">];</span>
<span class="w">        </span><span class="n">t_idx</span><span class="w"> </span><span class="n">l_neighborCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l_offsetY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">m_coarseFactor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">l_offsetY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">m_coarseFactor</span><span class="p">;</span><span class="w"> </span><span class="n">l_offsetY</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l_offsetX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">m_coarseFactor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">l_offsetX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">m_coarseFactor</span><span class="p">;</span><span class="w"> </span><span class="n">l_offsetX</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">l_idxX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l_ix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_offsetX</span><span class="p">;</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">l_idxY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l_iy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_offsetY</span><span class="p">;</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tsunami_lab</span><span class="o">::</span><span class="n">io</span><span class="o">::</span><span class="n">NetCDF</span><span class="o">::</span><span class="n">isInBounds</span><span class="p">(</span><span class="n">l_idxX</span><span class="p">,</span><span class="w"> </span><span class="n">l_idxY</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">l_height</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_height</span><span class="p">[</span><span class="n">l_idxY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_idxX</span><span class="p">];</span>
<span class="w">                    </span><span class="n">l_momentumX</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_momentumX</span><span class="p">[</span><span class="n">l_idxY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_idxX</span><span class="p">];</span>
<span class="w">                    </span><span class="n">l_momentumY</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_momentumY</span><span class="p">[</span><span class="n">l_idxY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_nx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l_idxX</span><span class="p">];</span>
<span class="w">                    </span><span class="n">l_neighborCount</span><span class="o">++</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">l_height</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">l_neighborCount</span><span class="p">;</span>
<span class="w">        </span><span class="n">l_momentumX</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">l_neighborCount</span><span class="p">;</span>
<span class="w">        </span><span class="n">l_momentumY</span><span class="p">[</span><span class="n">l_idx</span><span class="p">]</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">l_neighborCount</span><span class="p">;</span>
<span class="w">        </span><span class="n">l_idx</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="simulation-of-2011-tohoku-with-coarse-output">
<h3><span class="section-number">8.2.1. </span>Simulation of 2011 Tohoku with coarse Output<a class="headerlink" href="#simulation-of-2011-tohoku-with-coarse-output" title="Link to this heading"></a></h3>
<p>As time was short at the end, we simulated chile at 1000m grid size. One time with a coarse output modifire of <span class="math notranslate nohighlight">\(k = 100\)</span> and one time without to show the difference.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;dimension&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;nx&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">3500</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;ny&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">2950</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;xLen&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">3500000.0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;yLen&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2950000.0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;bathymetryFileName&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;chile_gebco20_usgs_250m_bath_fixed.nc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;displacementsFileName&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;chile_gebco20_usgs_250m_displ_fixed.nc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;epicenterOffsetX&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">-3000000</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;epicenterOffsetY&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">-1450000</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;simTime&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1.25</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;boundaryCond&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;OO&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;setup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;TsunamiEvent&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;coarseFactor&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">100</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Visualization of chile 1000m without coarse Output:</p>
<a class="reference internal image-reference" href="../_images/chile_1000m.png"><img alt="../_images/chile_1000m.png" src="../_images/chile_1000m.png" style="width: 400px;" /></a>
<p>Visualization of chile 1000m with coarse Output:</p>
<a class="reference internal image-reference" href="../_images/chile_1000m_coarse.png"><img alt="../_images/chile_1000m_coarse.png" src="../_images/chile_1000m_coarse.png" style="width: 400px;" /></a>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="assignment_6.html" class="btn btn-neutral float-left" title="7. Week Report 6" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="assignment_8.html" class="btn btn-neutral float-right" title="9. Weekly Report 8" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Bohdan Babii, Phillip Rothenbeck, Moritz Rätz, Marek Sommerfeld.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>